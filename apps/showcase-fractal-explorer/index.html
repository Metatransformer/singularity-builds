<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline'; connect-src https://8mag3jdi5f.execute-api.us-east-1.amazonaws.com; img-src 'self' data:; font-src 'self'; object-src 'none'; base-uri 'none'; form-action 'none';">
<script>
/* SingularityDB ‚Äî DO NOT MODIFY THIS BLOCK */
const SINGULARITY_DB_API = "https://8mag3jdi5f.execute-api.us-east-1.amazonaws.com/api/data";
const SINGULARITY_DB_NS = "showcase-fractal-explorer";
class SingularityDB {
  constructor(ns) { this.ns = ns; this.api = SINGULARITY_DB_API; }
  async get(key) {
    try {
      const r = await fetch(this.api + "/" + this.ns + "/" + encodeURIComponent(key));
      if (!r.ok) return null;
      return await r.json();
    } catch(e) { console.error("SingularityDB get error:", e); return null; }
  }
  async set(key, value) {
    try {
      const r = await fetch(this.api + "/" + this.ns + "/" + encodeURIComponent(key), {
        method: "PUT",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({value: value})
      });
      return await r.json();
    } catch(e) { console.error("SingularityDB set error:", e); return {ok: false}; }
  }
  async delete(key) {
    try {
      const r = await fetch(this.api + "/" + this.ns + "/" + encodeURIComponent(key), {
        method: "DELETE"
      });
      return await r.json();
    } catch(e) { console.error("SingularityDB delete error:", e); return {ok: false}; }
  }
  async list() {
    try {
      const r = await fetch(this.api + "/" + this.ns);
      if (!r.ok) return [];
      return await r.json();
    } catch(e) { console.error("SingularityDB list error:", e); return []; }
  }
}
const db = new SingularityDB(SINGULARITY_DB_NS);
/* END SingularityDB */
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandelbrot Explorer</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --surface: #1a1a1a;
            --accent: #00d4ff;
            --text: #e0e0e0;
            --muted: #888;
            --border: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
        }

        .loader {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: grid;
            place-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .container {
            display: grid;
            grid-template-columns: 300px 1fr;
            height: 100vh;
        }

        .sidebar {
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 1.5rem;
            overflow-y: auto;
        }

        .canvas-container {
            position: relative;
            overflow: hidden;
        }

        canvas {
            display: block;
            cursor: crosshair;
            transition: filter 0.2s ease;
        }

        h1 {
            font-size: clamp(1.25rem, 4vw, 1.5rem);
            font-weight: 700;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--accent), #40e0d0);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .control-group {
            margin-bottom: 1.5rem;
        }

        .control-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        input, select, button {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        button {
            background: var(--accent);
            color: var(--bg);
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        button:hover {
            background: #00b8e6;
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        .preset-button {
            background: var(--surface);
            color: var(--text);
            margin-bottom: 0.5rem;
            border: 1px solid var(--border);
        }

        .preset-button:hover {
            background: var(--border);
            color: var(--accent);
        }

        .stats {
            font-size: 0.75rem;
            color: var(--muted);
            background: var(--bg);
            padding: 0.75rem;
            border-radius: 6px;
            margin-top: 1rem;
        }

        .stats div {
            margin-bottom: 0.25rem;
        }

        .color-preview {
            width: 100%;
            height: 40px;
            border-radius: 4px;
            margin-top: 0.5rem;
            border: 1px solid var(--border);
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .sidebar {
                padding: 1rem;
                max-height: 200px;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
            
            .control-group {
                margin-bottom: 1rem;
            }
        }

        .zoom-info {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: rgba(26, 26, 26, 0.9);
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.875rem;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .sidebar {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="loader" id="loader">
        <div>
            <div class="spinner"></div>
            <div style="margin-top: 1rem; text-align: center; color: var(--muted);">Initializing Fractal Explorer...</div>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <h1>Mandelbrot Explorer</h1>
            
            <div class="control-group">
                <label>Color Palette</label>
                <select id="colorPalette">
                    <option value="classic">Classic Blue</option>
                    <option value="fire">Fire</option>
                    <option value="ice">Ice</option>
                    <option value="rainbow">Rainbow</option>
                    <option value="grayscale">Grayscale</option>
                    <option value="psychedelic">Psychedelic</option>
                </select>
                <div class="color-preview" id="colorPreview"></div>
            </div>

            <div class="control-group">
                <label>Max Iterations</label>
                <input type="range" id="iterations" min="50" max="500" value="100">
                <span id="iterValue">100</span>
            </div>

            <div class="control-group">
                <label>Zoom Speed</label>
                <input type="range" id="zoomSpeed" min="1.1" max="3" step="0.1" value="2">
                <span id="zoomValue">2x</span>
            </div>

            <div class="control-group">
                <button onclick="resetView()">Reset View</button>
            </div>

            <div class="control-group">
                <button onclick="savePreset()">Save Current View</button>
            </div>

            <div class="control-group">
                <label>Saved Views</label>
                <div id="presets"></div>
            </div>

            <div class="stats">
                <div>Zoom: <span id="zoomLevel">1x</span></div>
                <div>Center: <span id="centerCoords">(-0.5, 0)</span></div>
                <div>Render: <span id="renderTime">0ms</span></div>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="canvas"></canvas>
            <div class="zoom-info">
                <div>üñ±Ô∏è Click to zoom in ‚Ä¢ Right-click to zoom out</div>
                <div>üì± Tap to zoom ‚Ä¢ Long press to zoom out</div>
            </div>
        </div>
    </div>

    <a href="https://singularityengine.ai" style="position:fixed;bottom:8px;right:12px;font-size:11px;color:#333;text-decoration:none;font-family:system-ui;z-index:9999;opacity:0.5" onmouseover="this.style.opacity='1';this.style.color='#00d4ff'" onmouseout="this.style.opacity='0.5';this.style.color='#333'">Built by Singularity Engine ü§ñ</a>

    <script>
        class MandelbrotExplorer {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.imageData = null;
                
                this.centerX = -0.5;
                this.centerY = 0;
                this.zoom = 200;
                this.maxIter = 100;
                this.zoomSpeed = 2;
                this.currentPalette = 'classic';
                
                this.isRendering = false;
                this.lastRenderTime = 0;
                
                this.setupCanvas();
                this.setupEventListeners();
                this.updateColorPreview();
                this.render();
                
                this.loadPresets();
            }

            setupCanvas() {
                const resize = () => {
                    const container = this.canvas.parentElement;
                    this.canvas.width = container.clientWidth;
                    this.canvas.height = container.clientHeight;
                    this.imageData = this.ctx.createImageData(this.canvas.width, this.canvas.height);
                    if (!this.isRendering) {
                        this.render();
                    }
                };
                
                window.addEventListener('resize', resize);
                resize();
            }

            setupEventListeners() {
                const iterSlider = document.getElementById('iterations');
                const zoomSlider = document.getElementById('zoomSpeed');
                const paletteSelect = document.getElementById('colorPalette');
                
                iterSlider.addEventListener('input', (e) => {
                    this.maxIter = parseInt(e.target.value);
                    document.getElementById('iterValue').textContent = this.maxIter;
                    this.render();
                });
                
                zoomSlider.addEventListener('input', (e) => {
                    this.zoomSpeed = parseFloat(e.target.value);
                    document.getElementById('zoomValue').textContent = this.zoomSpeed + 'x';
                });
                
                paletteSelect.addEventListener('change', (e) => {
                    this.currentPalette = e.target.value;
                    this.updateColorPreview();
                    this.render();
                });

                // Mouse events
                this.canvas.addEventListener('click', (e) => {
                    this.handleZoom(e, true);
                });

                this.canvas.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.handleZoom(e, false);
                });

                // Touch events
                let touchStartTime = 0;
                this.canvas.addEventListener('touchstart', (e) => {
                    touchStartTime = Date.now();
                });

                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    const touchDuration = Date.now() - touchStartTime;
                    const zoomIn = touchDuration < 500;
                    this.handleZoom(e.changedTouches[0], zoomIn);
                });
            }

            handleZoom(event, zoomIn) {
                const rect = this.canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                
                const newCenterX = this.centerX + (x - this.canvas.width / 2) / this.zoom;
                const newCenterY = this.centerY + (y - this.canvas.height / 2) / this.zoom;
                
                this.centerX = newCenterX;
                this.centerY = newCenterY;
                this.zoom *= zoomIn ? this.zoomSpeed : (1 / this.zoomSpeed);
                
                this.updateStats();
                this.render();
            }

            mandelbrot(x0, y0) {
                let x = 0, y = 0;
                let iteration = 0;
                
                while (x * x + y * y <= 4 && iteration < this.maxIter) {
                    const xtemp = x * x - y * y + x0;
                    y = 2 * x * y + y0;
                    x = xtemp;
                    iteration++;
                }
                
                return iteration;
            }

            getColor(iterations) {
                if (iterations === this.maxIter) {
                    return [0, 0, 0, 255];
                }
                
                const t = iterations / this.maxIter;
                const palettes = {
                    classic: (t) => [
                        Math.floor(9 * (1 - t) * t * t * t * 255),
                        Math.floor(15 * (1 - t) * (1 - t) * t * t * 255),
                        Math.floor(8.5 * (1 - t) * (1 - t) * (1 - t) * t * 255),
                        255
                    ],
                    fire: (t) => [
                        Math.floor(255 * Math.min(1, 2 * t)),
                        Math.floor(255 * Math.max(0, 2 * t - 1)),
                        Math.floor(255 * Math.max(0, 3 * t - 2)),
                        255
                    ],
                    ice: (t) => [
                        Math.floor(255 * Math.max(0, 3 * t - 2)),
                        Math.floor(255 * Math.min(1, 2 * t)),
                        Math.floor(255 * t),
                        255
                    ],
                    rainbow: (t) => [
                        Math.floor(255 * (Math.sin(6.28 * t) * 0.5 + 0.5)),
                        Math.floor(255 * (Math.sin(6.28 * t + 2.09) * 0.5 + 0.5)),
                        Math.floor(255 * (Math.sin(6.28 * t + 4.18) * 0.5 + 0.5)),
                        255
                    ],
                    grayscale: (t) => {
                        const intensity = Math.floor(255 * t);
                        return [intensity, intensity, intensity, 255];
                    },
                    psychedelic: (t) => [
                        Math.floor(255 * Math.abs(Math.sin(20 * t))),
                        Math.floor(255 * Math.abs(Math.sin(20 * t + 2))),
                        Math.floor(255 * Math.abs(Math.sin(20 * t + 4))),
                        255
                    ]
                };
                
                return palettes[this.currentPalette](t);
            }

            render() {
                if (this.isRendering) return;
                this.isRendering = true;
                
                const startTime = performance.now();
                const width = this.canvas.width;
                const height = this.canvas.height;
                const data = this.imageData.data;
                
                for (let py = 0; py < height; py++) {
                    for (let px = 0; px < width; px++) {
                        const x0 = this.centerX + (px - width / 2) / this.zoom;
                        const y0 = this.centerY + (py - height / 2) / this.zoom;
                        
                        const iterations = this.mandelbrot(x0, y0);
                        const color = this.getColor(iterations);
                        const index = (py * width + px) * 4;
                        
                        data[index] = color[0];
                        data[index + 1] = color[1];
                        data[index + 2] = color[2];
                        data[index + 3] = color[3];
                    }
                }
                
                this.ctx.putImageData(this.imageData, 0, 0);
                
                this.lastRenderTime = performance.now() - startTime;
                this.updateStats();
                this.isRendering = false;
            }

            updateStats() {
                document.getElementById('zoomLevel').textContent = 
                    this.zoom < 1000 ? Math.round(this.zoom / 200) + 'x' : 
                    (this.zoom / 200).toExponential(2) + 'x';
                    
                document.getElementById('centerCoords').textContent = 
                    `(${this.centerX.toFixed(6)}, ${this.centerY.toFixed(6)})`;
                    
                document.getElementById('renderTime').textContent = 
                    Math.round(this.lastRenderTime) + 'ms';
            }

            updateColorPreview() {
                const preview = document.getElementById('colorPreview');
                const canvas = document.createElement('canvas');
                canvas.width = preview.clientWidth || 200;
                canvas.height = 40;
                const ctx = canvas.getContext('2d');
                
                for (let x = 0; x < canvas.width; x++) {
                    const t = x / canvas.width;
                    const color = this.getColor(Math.floor(t * this.maxIter));
                    ctx.fillStyle = `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${color[3] / 255})`;
                    ctx.fillRect(x, 0, 1, canvas.height);
                }
                
                preview.style.backgroundImage = `url(${canvas.toDataURL()})`;
                preview.style.backgroundSize = 'cover';
            }

            async savePreset() {
                const preset = {
                    centerX: this.centerX,
                    centerY: this.centerY,
                    zoom: this.zoom,
                    palette: this.currentPalette,
                    iterations: this.maxIter,
                    timestamp: Date.now()
                };
                
                const presets = await db.get('presets') || [];
                presets.push(preset);
                
                if (presets.length > 10) {
                    presets.shift();
                }
                
                await db.set('presets', presets);
                this.loadPresets();
            }

            async loadPresets() {
                const presets = await db.get('presets') || [];
                const container = document.getElementById('presets');
                
                if (presets.length === 0) {
                    container.innerHTML = '<div style="color: var(--muted); font-size: 0.75rem;">No saved views yet</div>';
                    return;
                }
                
                container.innerHTML = presets.map((preset, index) => {
                    const date = new Date(preset.timestamp).toLocaleString();
                    return `<button class="preset-button" onclick="explorer.loadPreset(${index})">
                        View ${index + 1} - ${preset.palette}<br>
                        <small style="opacity: 0.7">${date}</small>
                    </button>`;
                }).join('');
            }

            async loadPreset(index) {
                const presets = await db.get('presets') || [];
                const preset = presets[index];
                if (!preset) return;
                
                this.centerX = preset.centerX;
                this.centerY = preset.centerY;
                this.zoom = preset.zoom;
                this.currentPalette = preset.palette;
                this.maxIter = preset.iterations;
                
                document.getElementById('colorPalette').value = this.currentPalette;
                document.getElementById('iterations').value = this.maxIter;
                document.getElementById('iterValue').textContent = this.maxIter;
                
                this.updateColorPreview();
                this.render();
            }
        }

        function resetView() {
            explorer.centerX = -0.5;
            explorer.centerY = 0;
            explorer.zoom = 200;
            explorer.render();
        }

        function savePreset() {
            explorer.savePreset();
        }

        // Initialize app
        let explorer;

        window.addEventListener('load', async () => {
            // Small delay to show loader
            await new Promise(resolve => setTimeout(resolve, 500));
            
            explorer = new MandelbrotExplorer();
            
            document.getElementById('loader').classList.add('hidden');
        });
    </script>
</body>
</html>