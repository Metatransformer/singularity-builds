<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline'; connect-src https://*.execute-api.*.amazonaws.com; img-src 'self' data:; font-src 'self'; object-src 'none'; base-uri 'none'; form-action 'none';">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GhibliCz - Ticker & Fee Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: #b0b0b0;
            font-size: 1.1rem;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section h2 {
            color: #4facfe;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #c0c0c0;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #e0e0e0;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.3);
        }

        .btn {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .btn.danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .ticker-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(79, 172, 254, 0.1);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .ticker-symbol {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4facfe;
        }

        .ticker-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00f2fe;
        }

        .fee-recipient {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(0, 242, 254, 0.1);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .fee-recipient .handle {
            color: #00f2fe;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .status {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .status.success {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
            border: 1px solid rgba(46, 213, 115, 0.3);
        }

        .status.error {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .ticker-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .ticker-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ticker-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .ticker-display {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>GhibliCz Ticker & Fee Manager</h1>
            <p>Manage tickers and send fees to @metatransformr</p>
        </div>

        <div class="section">
            <h2>Fee Recipient</h2>
            <div class="fee-recipient">
                <div class="handle">@metatransformr</div>
            </div>
        </div>

        <div class="section">
            <h2>Add/Update Ticker</h2>
            <div class="form-group">
                <label for="tickerSymbol">Ticker Symbol</label>
                <input type="text" id="tickerSymbol" placeholder="e.g., AAPL, BTC, TSLA">
            </div>
            <div class="form-group">
                <label for="tickerPrice">Current Price</label>
                <input type="number" id="tickerPrice" step="0.01" placeholder="Enter price">
            </div>
            <div class="form-group">
                <label for="tickerNotes">Notes (optional)</label>
                <textarea id="tickerNotes" rows="3" placeholder="Additional information about this ticker"></textarea>
            </div>
            <button class="btn" onclick="saveTicker()">Save Ticker</button>
        </div>

        <div class="section">
            <h2>Current Tickers</h2>
            <div id="tickerList" class="ticker-list">
                <p style="text-align: center; color: #888;">Loading tickers...</p>
            </div>
            <button class="btn secondary" onclick="loadTickers()">Refresh Tickers</button>
        </div>

        <div class="section">
            <h2>Fee Management</h2>
            <div class="form-group">
                <label for="feeAmount">Fee Amount</label>
                <input type="number" id="feeAmount" step="0.01" placeholder="Enter fee amount">
            </div>
            <div class="form-group">
                <label for="feeDescription">Fee Description</label>
                <input type="text" id="feeDescription" placeholder="Description of the fee">
            </div>
            <button class="btn" onclick="sendFee()">Send Fee to @metatransformr</button>
        </div>

        <div id="status"></div>
    </div>

    <script>
        class SingularityDB {
            constructor(namespace) {
                this.namespace = namespace;
                this.apiUrl = "https://your-api-gateway.execute-api.us-east-1.amazonaws.com/api/data";
            }
            async get(key) {
                const res = await fetch(`${this.apiUrl}/${this.namespace}/${key}`);
                if (res.status === 404) return null;
                const data = await res.json();
                return data.value;
            }
            async set(key, value) {
                const res = await fetch(`${this.apiUrl}/${this.namespace}/${key}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ value }),
                });
                return res.json();
            }
            async delete(key) {
                const res = await fetch(`${this.apiUrl}/${this.namespace}/${key}`, {
                    method: "DELETE",
                });
                return res.json();
            }
            async list() {
                const res = await fetch(`${this.apiUrl}/${this.namespace}`);
                return res.json();
            }
        }

        const db = new SingularityDB('ghiblicz-with-same-ticker-and-send-488105');

        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }

        async function saveTicker() {
            const symbol = document.getElementById('tickerSymbol').value.trim().toUpperCase();
            const price = parseFloat(document.getElementById('tickerPrice').value);
            const notes = document.getElementById('tickerNotes').value.trim();

            if (!symbol || isNaN(price)) {
                showStatus('Please enter a valid ticker symbol and price', 'error');
                return;
            }

            try {
                const tickerData = {
                    symbol,
                    price,
                    notes,
                    lastUpdated: new Date().toISOString()
                };

                await db.set(`ticker_${symbol}`, tickerData);
                showStatus(`Ticker ${symbol} saved successfully`);
                
                // Clear form
                document.getElementById('tickerSymbol').value = '';
                document.getElementById('tickerPrice').value = '';
                document.getElementById('tickerNotes').value = '';
                
                loadTickers();
            } catch (error) {
                showStatus('Error saving ticker: ' + error.message, 'error');
            }
        }

        async function loadTickers() {
            try {
                const data = await db.list();
                const tickerList = document.getElementById('tickerList');
                
                if (!data.keys || data.keys.length === 0) {
                    tickerList.innerHTML = '<p style="text-align: center; color: #888;">No tickers found</p>';
                    return;
                }

                const tickers = [];
                for (const key of data.keys) {
                    if (key.startsWith('ticker_')) {
                        const tickerData = await db.get(key);
                        if (tickerData) {
                            tickers.push(tickerData);
                        }
                    }
                }

                if (tickers.length === 0) {
                    tickerList.innerHTML = '<p style="text-align: center; color: #888;">No tickers found</p>';
                    return;
                }

                tickerList.innerHTML = tickers.map(ticker => `
                    <div class="ticker-item">
                        <div class="ticker-display" style="flex: 1; margin-bottom: 0;">
                            <div>
                                <div class="ticker-symbol">${ticker.symbol}</div>
                                ${ticker.notes ? `<div style="font-size: 0.9rem; color: #888;">${ticker.notes}</div>` : ''}
                            </div>
                            <div class="ticker-price">$${ticker.price.toFixed(2)}</div>
                        </div>
                        <button class="btn danger" onclick="deleteTicker('${ticker.symbol}')" style="margin: 0; margin-left: 10px;">Delete</button>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('tickerList').innerHTML = '<p style="text-align: center; color: #ff6b6b;">Error loading tickers</p>';
                showStatus('Error loading tickers: ' + error.message, 'error');
            }
        }

        async function deleteTicker(symbol) {
            if (!confirm(`Are you sure you want to delete ticker ${symbol}?`)) {
                return;
            }

            try {
                await db.delete(`ticker_${symbol}`);
                showStatus(`Ticker ${symbol} deleted successfully`);
                loadTickers();
            } catch (error) {
                showStatus('Error deleting ticker: ' + error.message, 'error');
            }
        }

        async function sendFee() {
            const amount = parseFloat(document.getElementById('feeAmount').value);
            const description = document.getElementById('feeDescription').value.trim();

            if (isNaN(amount) || amount <= 0) {
                showStatus('Please enter a valid fee amount', 'error');
                return;
            }

            if (!description) {
                showStatus('Please enter a fee description', 'error');
                return;
            }

            try {
                const feeRecord = {
                    amount,
                    description,
                    recipient: '@metatransformr',
                    timestamp: new Date().toISOString(),
                    id: Date.now().toString()
                };

                await db.set(`fee_${feeRecord.id}`, feeRecord);
                showStatus(`Fee of $${amount.toFixed(2)} recorded for @metatransformr`);
                
                // Clear form
                document.getElementById('feeAmount').value = '';
                document.getElementById('feeDescription').value = '';
            } catch (error) {
                showStatus('Error recording fee: ' + error.message, 'error');
            }
        }

        // Load tickers on page load
        loadTickers();
    </script>
</body>
</html>